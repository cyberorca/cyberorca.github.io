<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <!-- Create a <video> element for the camera preview -->
    <video id="video"></video>

    <!-- Create a <canvas> element for the filtered preview -->
    <canvas id="canvas"></canvas>

    <script>
        // Get the video and canvas elements
        var video = document.getElementById('video');
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');

        // Check if the browser supports the getUserMedia API
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            // Get the video stream from the camera
            navigator.mediaDevices.getUserMedia({
                video: true
            }).then(function(stream) {
                // Set the src attribute of the video element
                // to the object URL for the video stream
                video.srcObject = stream;
                video.play();

                // Set the dimensions of the canvas
                // to match the dimensions of the video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                // Draw the video frame to the canvas
                // on a regular interval
                setInterval(function() {
                    context.drawImage(video, 0, 0);

                    // Get the image data from the canvas
                    var imageData = context.getImageData(0, 0, canvas.width, canvas.height);

                    // Loop through all the pixels in the image data
                    for (var i = 0; i < imageData.data.length; i += 4) {
                        // Get the red, green, and blue values of the pixel
                        var r = imageData.data[i];
                        var g = imageData.data[i + 1];
                        var b = imageData.data[i + 2];

                        // Calculate the grayscale value of the pixel
                        // using a common grayscale conversion formula
                        var gray = 0.2126 * r + 0.7152 * g + 0.0722 * b;

                        // Set the red, green, and blue values of the pixel
                        // to the grayscale value
                        imageData.data[i] = gray;
                        imageData.data[i + 1] = gray;
                        imageData.data[i + 2] = gray;
                    }

                    // Put the modified image data back on the canvas
                    context.putImageData(imageData, 0, 0);
                }, 16);
            });
        }
    </script>


    <!-- Create a <button> to start and stop recording -->
    <button id="record-button">Start Recording</button>

    <script>
        // Get the record button
        var recordButton = document.getElementById('record-button');

        // Flag to indicate whether recording is in progress
        var isRecording = false;

        // Create a MediaRecorder instance
        var mediaRecorder = new MediaRecorder();

        // Create a Blob for the recorded audio
        var recordedBlob;

        // Add a click event listener to the record button
        recordButton.addEventListener('click', function() {
            // If recording is in progress, stop it
            if (isRecording) {
                mediaRecorder.stop();
            }
            // Otherwise, start recording
            else {
                // Request access to the user's microphone
                navigator.mediaDevices.getUserMedia({
                    audio: true
                }).then(function(stream) {
                    // Set the source of the MediaRecorder instance
                    // to the user's microphone
                    mediaRecorder.srcObject = stream;

                    // Set the audio MIME type
                    mediaRecorder.mimeType = 'audio/wav';

                    // Start recording
                    mediaRecorder.start();

                    // Set the isRecording flag to true
                    isRecording = true;

                    // Change the text of the record button
                    recordButton.innerText = 'Stop Recording';

                    // Create a handler to process the dataavailable event
                    mediaRecorder.ondataavailable = function(e) {
                        // Add the audio data to the recordedBlob
                        recordedBlob = new Blob([recordedBlob, e.data], {
                            type: 'audio/wav'
                        });
                    };

                    // Create a handler for the stop event
                    mediaRecorder.onstop = function() {
                        // Set the isRecording flag to false
                        isRecording = false;

                        // Change the text of the record button
                        recordButton.innerText = 'Start Recording';

                        // Create an anchor element to download the audio
                        var downloadAnchor = document.createElement('a');

                        // Set the download attribute of the anchor
                        // to the filename of the recorded audio
                        downloadAnchor.download = 'recorded-audio.wav';

                        // Set the href attribute of the anchor to
                        // the URL of the recordedBlob object
                        downloadAnchor.href = URL.createObjectURL(recordedBlob);

                        // Click the anchor to download the audio
                        downloadAnchor.click();
                    };
                });
            }
        });
    </script>

</body>

</html>